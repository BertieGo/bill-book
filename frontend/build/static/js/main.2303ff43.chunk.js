(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{227:function(e,t,a){e.exports=a(411)},232:function(e,t,a){},410:function(e,t,a){},411:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(19),i=a.n(c),o=(a(232),a(28)),l=a(29),s=a(31),u=a(30),m=a(87),h=a.n(m),p=a(212),g=a(414),f=a(75),d=a.n(f),E=a(47),v=a.n(E),b=[{title:"\u6536/\u652f",dataIndex:"type",render:function(e){return 0===e?"\u652f\u51fa":"\u6536\u5165"}},{title:"\u65f6\u95f4",dataIndex:"time",render:function(e){return v()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"\u7c7b\u578b",dataIndex:"title"},{title:"\u91d1\u989d\uff08\uffe5\uff09",dataIndex:"amount",sorter:function(e,t){return e.amount-t.amount}}],y=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"shouldComponentUpdate",value:function(e,t,a){return!d()(this.props.data,e.data)}},{key:"render",value:function(){var e=this.props,t=e.loading,a=e.data;return r.a.createElement("div",{className:"mt20"},r.a.createElement("div",{className:"mb10 title"},"\u8d26\u5355\uff1a"),r.a.createElement(g.a,{loading:t,columns:b,dataSource:a}))}}]),a}(r.a.Component),C=a(52),j=a.n(C),B=a(412),O=a(413),w=a(415),F=a(94),M={0:"\u652f\u51fa",1:"\u6536\u5165"},I="\u8bf7\u586b\u5199\u65f6\u95f4",D="\u8bf7\u9009\u62e9\u7c7b\u578b",N="\u8bf7\u586b\u5199\u91d1\u989d",k=F.a.Option,S=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).onChange=function(e){var t=n.props.onChange;j()(t)&&t(e)},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.categories,a=e.isFisFetchingBillCategories;return r.a.createElement(F.a,{style:{width:120},onChange:this.onChange,loading:a,allowClear:!0,placeholder:D},t.map((function(e){return r.a.createElement(k,{value:e.id},e.name)})))}}]),a}(r.a.Component),A=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).onMonthChange=function(t){var a=e.props.onMonthChange;j()(a)&&a(t?t.format("YYYY-MM"):"")},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.onCategoryChange,a=e.categories,n=e.isFisFetchingBillCategories;return r.a.createElement(B.a,{className:"mb20"},r.a.createElement(O.a,{span:2,className:"title"},"\u7b5b\u9009\uff1a"),r.a.createElement(O.a,{span:4},r.a.createElement("span",null,"\u6708\u4efd\uff1a"),r.a.createElement(w.a,{placeholder:"\u8bf7\u9009\u62e9\u6708\u4efd",onChange:this.onMonthChange,picker:"month"})),r.a.createElement(O.a,{span:4},r.a.createElement("span",null,"\u7c7b\u578b\uff1a"),r.a.createElement(S,{onChange:t,categories:a,isFisFetchingBillCategories:n})))}}]),a}(r.a.Component),Y=a(416),P=a(417),x=a(37),R=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).onFinish=function(t){var a=e.props.onAddBillItem,n={time:t.time.format("x"),amount:+t.amount,category:t.category};j()(a)&&a(n)},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.categories,a=e.isFisFetchingBillCategories;return r.a.createElement(Y.a,{onFinish:this.onFinish},r.a.createElement(B.a,null,r.a.createElement(O.a,{className:"title",span:2},"\u5f55\u5165\uff1a"),r.a.createElement(O.a,{span:4},r.a.createElement(Y.a.Item,{name:"time",label:"\u65f6\u95f4",rules:[{type:"object",required:!0,message:I}]},r.a.createElement(w.a,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:I}))),r.a.createElement(O.a,{span:4},r.a.createElement(Y.a.Item,{name:"category",label:"\u7c7b\u578b",rules:[{type:"string",required:!0,message:D}]},r.a.createElement(S,{categories:t,isFisFetchingBillCategories:a}))),r.a.createElement(O.a,{span:3},r.a.createElement(Y.a.Item,{name:"amount",label:"\u91d1\u989d",rules:[{type:"string",required:!0,message:N}]},r.a.createElement(P.a,{placeholder:N,type:"number"}))),r.a.createElement(O.a,{span:2,className:"ml30"},r.a.createElement(Y.a.Item,null,r.a.createElement(x.a,{type:"primary",htmlType:"submit"},"\u6dfb\u52a0")))))}}]),a}(r.a.Component),L=a(48),T=function(e){return Number(e.toFixed(4))},H=function(e){return Math.floor(100*e)/100},_=function(e,t){return T(e/t*100)},q=a(125),J=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).width=void 0,n.height=void 0,n.renderPath=function(){var e=n.props.data,t=[],a=n.width/2,c=n.width/2,i=n.height/2,o=n.width,l=n.height/2,s=0;return e.forEach((function(e){var n=e.percent/100+s,u=360*n,m=H(c+a*Math.cos(u*Math.PI/180)),h=H(i+a*Math.sin(u*Math.PI/180)),p=e.percent/100*360>180?"1":"0",g="".concat(H(e.percent),"%"),f=T(e.amount);t.push(r.a.createElement(q.a,{title:r.a.createElement("div",{className:"nowrap"},"\u7c7b\u578b\uff1a".concat(e.title," \u91d1\u989d: ").concat(f," \u5360\u6bd4\uff1a").concat(g))},r.a.createElement("path",{d:"M".concat(o," ").concat(l," A ").concat(a," ").concat(a,", 0, ").concat(p,", 1, ").concat(m," ").concat(h," L ").concat(c," ").concat(i," Z"),fill:e.color}))),o=m,l=h,s=n})),t},n.width=200,n.height=200,n}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("svg",{width:"".concat(this.width,"px"),height:"".concat(this.height,"px"),version:"1.1",xmlns:"http://www.w3.org/2000/svg"},this.renderPath()))}}]),a}(r.a.Component),U=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,c=new Array(n),i=0;i<n;i++)c[i]=arguments[i];return(e=t.call.apply(t,[this].concat(c))).makeRowData=function(){var t=e.props.data,a=h()(t);if(t.length>0){var n=(a=a.sort((function(e,t){return t.amount-e.amount})))[0].percent;a.forEach((function(e){e.barPercent=_(e.percent,n)}))}return a},e.renderRow=function(e){var t="".concat(H(e.percent),"%"),a=T(e.amount);return r.a.createElement(B.a,null,r.a.createElement(q.a,{title:"\u91d1\u989d: ".concat(a," \u5360\u6bd4\uff1a").concat(t)},r.a.createElement(O.a,{span:20},r.a.createElement("div",{className:"row-bar",style:{width:"".concat(e.barPercent,"%"),backgroundColor:e.color}}))),r.a.createElement(O.a,{span:4},r.a.createElement("span",{className:"ml20"},a)))},e.renderRowChart=function(t){return r.a.createElement(B.a,{className:"mb10"},r.a.createElement(O.a,{span:4},t.title,"\uff1a"),r.a.createElement(O.a,{span:8},e.renderRow(t)))},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this.makeRowData();return r.a.createElement("div",null,e.map(this.renderRowChart))}}]),a}(r.a.Component),G=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,c=new Array(n),i=0;i<n;i++)c[i]=arguments[i];return(e=t.call.apply(t,[this].concat(c))).renderChart=function(e){return r.a.createElement(B.a,null,r.a.createElement(O.a,{span:14},r.a.createElement(U,{data:e})),r.a.createElement(O.a,{className:"vm",span:10},r.a.createElement(J,{data:e})))},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.categoryBillData,a=e.typeBillData;return r.a.createElement(B.a,null,r.a.createElement(O.a,{span:12,className:"mt20"},r.a.createElement("div",{className:"mb10 title"},"\u6536\u5165/\u652f\u51fa\u7edf\u8ba1\uff1a"),a.length>0?this.renderChart(a):r.a.createElement(L.a,{image:L.a.PRESENTED_IMAGE_SIMPLE})),r.a.createElement(O.a,{span:12,className:"mt20"},r.a.createElement("div",{className:"mb10 title"},"\u652f\u51fa\u7c7b\u578b\u7edf\u8ba1\uff1a"),t.length>0?this.renderChart(t):r.a.createElement(L.a,{image:L.a.PRESENTED_IMAGE_SIMPLE})))}}]),a}(r.a.Component),W=a(418);function Z(e,t,a){var n,r="";t&&"object"===typeof t&&Object.keys(t).length>0&&(r="?".concat((n=t,Object.keys(n).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(n[e]))})).join("&"))));var c="".concat("").concat(e).concat(r);return fetch(c,{cache:"no-cache"}).then((function(e){return a&&W.a.success(a),e.json()}))}function $(e){return t=e,a="\u6dfb\u52a0\u6210\u529f",fetch(""+"/api/bill",{body:JSON.stringify(t),cache:"no-cache",headers:{"content-type":"application/json"},method:"POST"}).then((function(e){return a&&W.a.success(a),e.json()}));var t,a}var z=function(){return"#"+(16777216+16777215*Math.random()).toString(16).substr(1,6)},K=(a(410),function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).filter=void 0,n.setBillData=function(){var e=n.filter,t=e.time,a=e.category;n.setState({isFetchingBill:!0},(function(){var e;(e={time:t,category:a},Z("/api/bill",e)).then((function(e){n.setState({billList:e.data,isFetchingBill:!1})}))}))},n.setBillCategories=function(){n.setState({isFetchingBillCategories:!0},(function(){Z("/api/bill/categories").then((function(e){n.setState({billCategories:e.data,isFetchingBillCategories:!1})}))}))},n.onMonthChange=function(e){n.filter.time=e||"",n.setBillData()},n.onCategoryChange=function(e){n.filter.category=e||"",n.setBillData()},n.onAddBillItem=function(e){$(e).then((function(){n.setBillData()}))},n.combineBillItem=function(e,t){var a=[];return e.forEach((function(e){var n=a.find((function(a){return a[t]===e[t]}));n?n.amount+=e.amount:a.push(e)})),a},n.getSum=function(e){return e.reduce((function(e,t){return e+t.amount}),0)},n.getTypeBillData=function(){var e=n.state.billList,t=h()(e),a=n.combineBillItem(t,"type"),r=n.getSum(a);return a.forEach((function(e){e.percent=_(e.amount,r),e.title=M[e.type],e.color=z()})),1===a.length&&a.push({title:M[Number(!a[0].type)],percent:0,amount:0}),a},n.getCategoryBillData=function(){var e=n.state.billList,t=h()(e);t=t.filter((function(e){return 0===e.type})).sort((function(e,t){return e.amount-t.amount}));var a=n.combineBillItem(t,"category"),r=n.getSum(a);return a.forEach((function(e){e.percent=_(e.amount,r),e.color=z()})),a},n.state={billList:[],isFetchingBill:!0,billCategories:[],isFetchingBillCategories:!0,billAmountList:[]},n.filter={time:"",category:""},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.setBillData(),this.setBillCategories()}},{key:"render",value:function(){var e=this.state,t=e.isFetchingBill,a=e.isFetchingBillCategories,n=e.billList,c=e.billCategories;return r.a.createElement("div",{className:"container"},r.a.createElement(A,{onMonthChange:this.onMonthChange,categories:c,onCategoryChange:this.onCategoryChange,isFisFetchingBillCategories:a}),r.a.createElement(R,{isFisFetchingBillCategories:a,categories:c,onAddBillItem:this.onAddBillItem}),t?r.a.createElement(p.a,null):r.a.createElement(r.a.Fragment,null,r.a.createElement(G,{categoryBillData:this.getCategoryBillData(),typeBillData:this.getTypeBillData()}),r.a.createElement(y,{loading:t,data:n})))}}]),a}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[227,1,2]]]);
//# sourceMappingURL=main.2303ff43.chunk.js.map