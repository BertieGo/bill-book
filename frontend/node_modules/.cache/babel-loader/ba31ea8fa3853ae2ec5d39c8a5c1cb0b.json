{"ast":null,"code":"import _classCallCheck from\"/workspace/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/workspace/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/workspace/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/workspace/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import cloneDeep from'lodash/cloneDeep';import{Spin}from'antd';import BillTable from\"./container/Table\";import Filter from'./container/Filter';import AddBillForm from'./container/AddBillForm';import Charts from\"./container/Charts\";import{BILL_TYPE}from'./constants';import{getBillList,getBillCategories,addBillItem}from'./request';import{getRandomColor}from\"./utils/color\";import'./App.css';import{getPercent}from\"./utils/math\";var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.filter=void 0;_this.setBillData=function(){var _this$filter=_this.filter,time=_this$filter.time,category=_this$filter.category;_this.setState({isFetchingBill:true},function(){getBillList({time:time,category:category}).then(function(res){_this.setState({billList:res.data,isFetchingBill:false});});});};_this.setBillCategories=function(){_this.setState({isFetchingBillCategories:true},function(){getBillCategories().then(function(res){_this.setState({billCategories:res.data,isFetchingBillCategories:false});});});};_this.onMonthChange=function(time){_this.filter.time=time||'';_this.setBillData();};_this.onCategoryChange=function(category){_this.filter.category=category||'';_this.setBillData();};_this.onAddBillItem=function(item){addBillItem(item).then(function(){_this.setBillData();});};_this.combineBillItem=function(bill,field){var result=[];bill.forEach(function(item){var target=result.find(function(i){return i[field]===item[field];});if(target){target.amount+=item.amount;}else{result.push(item);}});return result;};_this.getSum=function(bill){return bill.reduce(function(prev,next){return prev+next.amount;},0);};_this.getTypeBillData=function(){var billList=_this.state.billList;var copy=cloneDeep(billList);var result=_this.combineBillItem(copy,'type');var sum=_this.getSum(result);result.forEach(function(item){item.percent=getPercent(item.amount,sum);item.title=BILL_TYPE[item.type];item.color=getRandomColor();});if(result.length===1){result.push({title:BILL_TYPE[Number(!result[0].type)],percent:0,amount:0});}return result;};_this.getCategoryBillData=function(){var billList=_this.state.billList;var copy=cloneDeep(billList);copy=copy.filter(function(item){return item.type===0;}).sort(function(perv,next){return perv.amount-next.amount;});var result=_this.combineBillItem(copy,'category');var sum=_this.getSum(result);result.forEach(function(item){item.percent=getPercent(item.amount,sum);item.color=getRandomColor();});return result;};_this.state={billList:[],isFetchingBill:true,billCategories:[],isFetchingBillCategories:true,billAmountList:[]};_this.filter={time:'',category:''};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){this.setBillData();this.setBillCategories();}},{key:\"render\",value:function render(){var _this$state=this.state,isFetchingBill=_this$state.isFetchingBill,isFetchingBillCategories=_this$state.isFetchingBillCategories,billList=_this$state.billList,billCategories=_this$state.billCategories;return/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(Filter,{onMonthChange:this.onMonthChange,categories:billCategories,onCategoryChange:this.onCategoryChange,isFisFetchingBillCategories:isFetchingBillCategories}),/*#__PURE__*/React.createElement(AddBillForm,{isFisFetchingBillCategories:isFetchingBillCategories,categories:billCategories,onAddBillItem:this.onAddBillItem}),isFetchingBill?/*#__PURE__*/React.createElement(Spin,null):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Charts,{categoryBillData:this.getCategoryBillData(),typeBillData:this.getTypeBillData()}),/*#__PURE__*/React.createElement(BillTable,{loading:isFetchingBill,data:billList})));}}]);return App;}(React.Component);export default App;","map":{"version":3,"sources":["/workspace/src/App.tsx"],"names":["React","cloneDeep","Spin","BillTable","Filter","AddBillForm","Charts","BILL_TYPE","getBillList","getBillCategories","addBillItem","getRandomColor","getPercent","App","props","filter","setBillData","time","category","setState","isFetchingBill","then","res","billList","data","setBillCategories","isFetchingBillCategories","billCategories","onMonthChange","onCategoryChange","onAddBillItem","item","combineBillItem","bill","field","result","forEach","target","find","i","amount","push","getSum","reduce","prev","next","getTypeBillData","state","copy","sum","percent","title","type","color","length","Number","getCategoryBillData","sort","perv","billAmountList","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport cloneDeep from 'lodash/cloneDeep';\n\nimport { Spin, message } from 'antd';\n\nimport BillTable from \"./container/Table\";\nimport Filter from './container/Filter';\nimport AddBillForm from './container/AddBillForm';\nimport Charts  from \"./container/Charts\";\nimport { BILL_TYPE } from './constants';\nimport { IBill, IAppState, IFilter, IAddBillParam, IPathItem } from './declare';\n\nimport { getBillList, getBillCategories, addBillItem } from './request';\nimport {getRandomColor} from \"./utils/color\";\n\nimport './App.css';\nimport { getPercent} from \"./utils/math\";\n\nclass App extends React.Component<{}, IAppState> {\n\n    private filter: IFilter;\n\n    constructor(props: {}) {\n        super(props);\n        this.state = {\n            billList: [],\n            isFetchingBill: true,\n\n            billCategories: [],\n            isFetchingBillCategories: true,\n\n            billAmountList: []\n        }\n\n        this.filter = {\n            time: '',\n            category: ''\n        }\n    }\n\n    componentDidMount() {\n        this.setBillData();\n        this.setBillCategories();\n    }\n\n    setBillData = () => {\n        const { time, category } = this.filter;\n\n        this.setState({\n            isFetchingBill: true,\n        }, () => {\n            getBillList({\n                time,\n                category,\n            }).then((res) => {\n                this.setState({\n                    billList: res.data,\n                    isFetchingBill: false\n                })\n            })\n        })\n    }\n\n    setBillCategories = () => {\n        this. setState({\n            isFetchingBillCategories: true\n        }, () => {\n            getBillCategories().then((res) => {\n                this.setState({\n                    billCategories: res.data,\n                    isFetchingBillCategories: false,\n                });\n            })\n        })\n    }\n\n    onMonthChange = (time: string) => {\n        this.filter.time = time || '';\n        this.setBillData();\n    }\n\n    onCategoryChange = (category: string) => {\n        this.filter.category = category || '';\n        this.setBillData()\n    }\n\n    onAddBillItem = (item: IAddBillParam) => {\n        addBillItem(item).then(() => {\n            this.setBillData()\n        })\n    }\n\n    combineBillItem = (bill: IBill[], field: keyof IBill) => {\n        const result: IBill[] = [];\n        bill.forEach((item: IBill) => {\n            const target = result.find((i: IBill) => i[field] === item[field]);\n            if (target) {\n                target.amount += item.amount;\n            } else {\n                result.push(item);\n            }\n        });\n        return result;\n    }\n\n    getSum = (bill: IBill[]) => {\n        return bill.reduce((prev: number, next: IBill) => {\n            return prev + next.amount\n        }, 0);\n    }\n\n    getTypeBillData = () => {\n        const { billList } = this.state;\n        let copy = cloneDeep(billList);\n        let result = this.combineBillItem(copy, 'type');\n\n        const sum = this.getSum(result);\n\n        result.forEach((item: IBill) => {\n            item.percent = getPercent(item.amount, sum);\n            item.title = BILL_TYPE[item.type];\n            item.color = getRandomColor();\n        })\n\n        if (result.length === 1) {\n            result.push({\n                title: BILL_TYPE[Number(!result[0].type)],\n                percent: 0,\n                amount: 0,\n            } as IBill)\n        }\n\n        return result;\n    }\n\n    getCategoryBillData = () => {\n        const { billList } = this.state;\n        let copy = cloneDeep(billList);\n\n        copy = copy.filter(item => item.type === 0).sort((perv, next) => perv.amount - next.amount);\n\n        const result = this.combineBillItem(copy, 'category');\n\n        const sum = this.getSum(result);\n\n        result.forEach((item: IBill) => {\n            item.percent = getPercent(item.amount, sum);\n            item.color = getRandomColor()\n        })\n\n        return result;\n    }\n\n    render() {\n        const { isFetchingBill, isFetchingBillCategories, billList, billCategories } = this.state;\n        return (\n            <div className=\"container\">\n                <Filter\n                    onMonthChange={this.onMonthChange}\n                    categories={billCategories}\n                    onCategoryChange={this.onCategoryChange}\n                    isFisFetchingBillCategories={isFetchingBillCategories}\n                />\n                <AddBillForm\n                    isFisFetchingBillCategories={isFetchingBillCategories}\n                    categories={billCategories}\n                    onAddBillItem={this.onAddBillItem}\n                />\n                {\n                    isFetchingBill ? <Spin/> : (\n                        <React.Fragment>\n                            <Charts\n                                categoryBillData={this.getCategoryBillData()}\n                                typeBillData={this.getTypeBillData()}\n                            />\n                            <BillTable loading={isFetchingBill} data={billList} />\n                        </React.Fragment>\n                    )\n                }\n            </div>\n        );\n    }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}